<h1>
    教你搭建一个能轻松自创开发工具，并且集免上传代码，实时调试，自动发布，独立测试，按需部署于一体的神奇开发环境
</h1>
<h2>
    Index<br/>
</h2>
<ul class="anchor-link list-paddingleft-2">
    <li>
        <p>
            <a href="#step1">前言</a>
        </p>
    </li>
    <li>
        <p>
            &nbsp;&nbsp;&nbsp;&nbsp;<a href="#step1.1"></a>
        </p>
    </li>
    <li>
        <p>
            &nbsp;&nbsp;&nbsp;&nbsp;<a href="#step1.2"></a>
        </p>
    </li>
    <li>
        <p>
            <a href="#step2"></a>
        </p>
    </li>
    <li>
        <p>
            &nbsp;&nbsp;&nbsp;&nbsp;<a href="#step2.1"></a>
        </p>
    </li>
    <li>
        <p>
            &nbsp;&nbsp;&nbsp;&nbsp;<a href="#step2.2"></a>
        </p>
    </li>
    <li>
        <p>
            <a href="#step3"></a>
        </p>
    </li>
    <li>
        <p>
            &nbsp;&nbsp;&nbsp;&nbsp;<a href="#step3.1"></a>
        </p>
    </li>
    <li>
        <p>
            &nbsp;&nbsp;&nbsp;&nbsp;<a href="#step3.2"></a>
        </p>
    </li>
    <li>
        <p>
            &nbsp;&nbsp;&nbsp;&nbsp;<a href="#step3.3"></a>
        </p>
    </li>
    <li>
        <p>
            <a href="#step4"></a>
        </p>
    </li>
</ul>
<h2>
    前言
</h2>
<p>
    在 kintone 的日常开发中，经常有小伙伴碰到一系列的问题，比如：
</p>
<ul class=" list-paddingleft-2">
    <li>
        <p>
            每次改完代码都需要上传到 kintone 后台，才能看到效果，琐碎耗时
        </p>
    </li>
    <li>
        <p>
            团队开发需要打造一些小工具，以提升效率，但是工具开发本身也是一件耗时的事情，而且部署和版本迭代也是个难题
        </p>
    </li>
    <li>
        <p>
            有时候需要在真实环境下进行小范围试运行，但是上传自定义代码后会影响到所有人
        </p>
    </li>
    <li>
        <p>
            一个大范围使用的应用，不同的小团队和个人有不同的定制化需求，如何做到在一定范围内小规模部署？
        </p>
    </li>
</ul>
<p>
    以上这些问题其实可以通过一系列的环境搭建来解决，今天我们就来一步步实践演示一下如何去搭建这样一个环境。
</p>
<h2>
    原理介绍
</h2>
<p>
    首先我们来了解一下这个开发环境是基于什么样的基础搭建起来的。这对我们理解它的运作原理非常有帮助，如果后期有改造需求的话，这些内容将会非常有帮助。
</p>
<p>
    首先，上传 kintone 后台的自定义代码是有执行时间点的，它基本上是会在 kintone 的一些基础内容加载完之后执行，但是按 Web 的标准来说，他的执行时间点在【开始加载页面内容】之后，在【结束加载页面内容】之前。
</p>
<p>
    在知道了这点原理之后，就有一个想法冒了出来：“如果不上传代码到 kintone 后台，只要在相同的时间点执行相应的代码，应该有办法模拟相同的 kintone 自定义开发吧？”
</p>
<p>
    是的，答案的确是可以。我们依赖的是 Chrome 浏览器提供的 Extension 所赋予我们的能力。Extension 旨在以 API 形式提供很多浏览器扩展能力给开发者，而开发者可以根据实际需求来制作自己的 Extension。而 Extension 其中的一项能力就是 把 JS 注入到网页中，而且它提供的注入时间点也能正好满足 kinone 自定义代码的执行时机。这样基础条件就具备了。
</p>
<p>
    虽然我们可以制作 Extension 来做到所有事情，但是 Extension 的制作需要额外的学习，而且最麻烦的是 Extension 需要通过官方商店的审核，虽然可以通过手动导入开发模式来解决，但是一系列的问题导致这种方式效率低下，在实际运用层面变得不可行。
</p>
<p>
    好在有一款叫做 Tampermonkey （以下简称TM）的 Extension，它的作用是可以在网页中注入 JS，它在注入 JS 方面继承了 Extension的能力，而且不需要经过审核，这样就可以做到快速迭代，而且不需要学习额外的知识。
</p>
<p>
    现在理论基础有了，工具也有了，可以说是万事俱备只欠东风了。接下来我们就来一步步实践一下。
</p>
<h2>
    制作开发环境
</h2>
<p>
    要制作一个东西，我们在动手之前，最好对它应该具备什么样的功能做到心理有数。我们先总结一下功能列表。分为两个部分：主要功能和可选功能。主要功能就是最核心的功能，如果没有这些功能，那么这个环境就没有存在的必要了。可选功能则是一些锦上添花的东西，根据实际需求可以取舍的。
</p>
<p>
    主要功能：
</p>
<ul class=" list-paddingleft-2">
    <li>
        <p>
            编辑器后立即在浏览器体现效果。也就是免除一切的代码上传等操作。
        </p>
        <p>
            TM 的 Header 信息必须是自动生成，免去人工编写。
        </p>
    </li>
</ul>
<p>
    可选功能：
</p>
<ul class=" list-paddingleft-2">
    <li>
        <p>
            处理各种资源。比如图片、CSS、HTML 等。
        </p>
        <p>
            处理 TypeScript 的能力。
        </p>
        <p>
            分离开发环境和生产环境。
        </p>
        <p>
            代码风格约束，整理，检查。
        </p>
        <p>
            git 版本控制相关。比如：忽略文件种类。
        </p>
        <p>
            代码风格约束，整理，检查。
        </p>
        <p>
            服务器自动编译，方便发布商店。
        </p>
    </li>
</ul>
<p>
    以上这些功能，我们发现和开发一款前端脚手架非常相似，如果要我们自己从头开始制作是非常费时费力的，好在开源社区的力量是很强大的，已经有网友开源了<a href="https://github.com/forestsheep911/capricious-monkey">他的仓库</a>，我们可以直接拿来用。
</p>
<p class="operaCheck">
    注意：开源社区所提供的内容，请大家遵守开源协议。Cybozu 不对其功能和安全性负责。
</p>